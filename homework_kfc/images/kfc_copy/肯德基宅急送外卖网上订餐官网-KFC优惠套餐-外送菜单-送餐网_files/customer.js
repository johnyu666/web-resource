var KFC_POST=function(A,C,B){$.ajax({url:requestContextPath+"/"+A,data:C,type:"post",dataType:"json",beforeSend:function(){base.yumOpenLoading()},success:function(D){if(B&&$.isFunction(B)){B(D)}},complete:function(E,D){base.yumCloseLoading()},error:function(){base.yumTrackAlert(property.BadRequest)}})};var KFC_Base=function(D){var A=$("#userEmail");var C=$("#username");var G=$(".modifyBtn");C.tip(property.customerNameTip);var F="";C.change(function(){var I=this.value;var H=I.replace(/[^\x00-\xff]/g,"xx").length;if(H>24){base.yumTrackAlert(property.notLonger);this.value=F;return}if(!common.isStr(I)){base.yumTrackAlert(property.customerNameNotRight);this.value=F;return}F=I});var B=function(){var H=$.trim(A.val());var I=$.trim(C.val());var J=$("input[name=gender]:checked");if(!D.isNewUser){return true}if(A[0]&&A.is(":visible")){if(H==""){base.yumTrackAlert(property.emailNotNull);return false}if(!common.isEmail(H)){base.yumTrackAlert(property.emailNotcorrect);return false}}if(C[0]&&C.is(":visible")){if(I==""||I==property.customerNameTip){base.yumTrackAlert(property.customerNameNotNull);return false}if(common.isStr2(I,2)){base.yumTrackAlert(property.customerNameNotRight);return false}if(!J[0]){base.yumTrackAlert(property.genderNotChoose);return false}}return true};var E=function(){var H=$(this);var K=C.val()==property.customerNameTip?"":C.val();var M=$("input[name=gender]:checked");var I=$(".customerName");var J=function(){C.val(property.customerNameTip);if(M[0]){M[0].checked=false}H.parent().hide().siblings().show()};var L=M.val();if(C.is(":visible")){if(K==""){base.yumTrackAlert(property.customerNameNotNull);return}if(common.isStr2(K,2)){base.yumTrackAlert(property.customerNameNotRight);return false}if(!L){base.yumTrackAlert(property.genderNotChoose);return}KFC_POST("/updateInfo.action",{customerName:$.trim(K),gender:M.val()},function(O){if(O.code==serviceCode.SUC_CODE){L=L==0?pageMessage.common_Mr:pageMessage.common_Ms;var N=H.parent().siblings().children();H.parent().siblings().text(K+" "+L).append(N);I.text($.trim(K+" "+L));J()}else{base.yumTrackAlert(property.serviceUnknown)}})}else{J()}};this.isFinish=function(){return B()};G.live("click",E)};var KFC_Phone=function(F){var J=common.isMobile($("#mobiOrMail").val())?$("#mobiOrMail").val():"";var C=$("#addPhone");var A=$("#phone_1");var B=$("#addPhoneBtn");var R=$("#savePhoneBtn");var E=$("input[name=selPhoneId]");var H=$(".deletePhoneBtn");var I=$("#newMobile");var O=$("#newTel1");var P=$("#newTel2");var Q=$("#newTel3");var N='<li><input name="phone" type="hidden" value="{1}"><input style="float:left" name="selPhoneId" type="radio" value="{2}"><a name="selPhoneLink" style="text-decoration: none;display: block;width: 493px;float:left" href="javascript:void(0);">{0}&nbsp;{1}</a></td><div style="float:right"><div class="del_btn" value="{2}"><a href="javascript:;" class="deletePhoneBtn"></a></div></div></li>';var K=$("#telephone_1 .info_table_1");var M=$('<div class="selectItem"><div class="selectItemCount"></div></div>');I.tip(property.mobileTip);O.tip(property.areaCodeTip);P.tip(property.telephoneTip);var L=function(){I.val(property.mobileTip);O.val(property.areaCodeTip);P.val(property.telephoneTip);Q.val("")};E.live("click",function(){L();C.hide();B.show();R.hide();$(this).parents("#telephone_1").find(".selectcolor").removeClass("selectcolor");$(this).parens("li").addClass("selectcolor")});$("[name=selPhoneLink]").live("click",function(){L();C.hide();B.show();R.hide();$(this).parents("#telephone_1").find(".selectcolor").removeClass("selectcolor");$(this).parents("li").addClass("selectcolor");$(this).parents("li").find("[name=selPhoneId]").attr("checked","checked")});E.each(function(){var S=$(this);F.phoneList.push(S.next("[name=phone]").val())});E.live("click",function(){$(this).click(function(){L()})});B.click(function(){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_xzlxdh"," WT.msg","21")}$(this).hide();R.show();C.show();$("input[name=selPhoneId]").each(function(){this.checked=false;$(this).parents("li").removeClass("selectcolor")})});O.keyup(function(T){var U=$(this);var S=$.trim(this.value);if(S&&(!common.isStr(S)||common.isStr2(S,1))){M.remove();base.yumTrackAlert(property.invaildStringError);return}if((T.keyCode>65&&T.keyCode<90)||T.keyCode==32||T.keyCode==8){if(S&&S!=property.areaCodeTip){if(/^\d+$/.test(S)){M.remove();return}M.find(".selectItemCount").html('<img src="res/images/loading.gif"/>');M.css({top:"60px",left:"0px"});$(this).after(M.show());var V=function(W){return function(){U.val(W.zoneno);M.remove()}};KFC_POST("/queryCity.action",{cityName:S},function(X){$(".selectItemCount").data("current",-1);var Y=$("<ul></ul>");if(X&&X.length>0){for(var a in X){var Z=X[a];var W=$("<li>"+Z.name+Z.districtName+"-"+Z.zoneno+" "+Z.nameen+"</li>");W.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});W.click(V(Z));Y.append(W)}}else{Y.append("<li>"+property.noMatch+"</li>")}M.find(".selectItemCount").html("").append(Y)})}else{M.remove()}}}).keydown(function(U){var S=$(".selectItemCount").find("li"),V=$(".selectItemCount").data("current")||0,T=S.length;if(9==U.keyCode){if(1==T){S.first().click()}}else{if(38==U.keyCode||40==U.keyCode){if(38==U.keyCode){V=V>0?V-1:T-1}else{if(40==U.keyCode){V=V<T-1?V+1:0}}$(".selectItemCount").data("current",V).find("li").removeClass("hover").eq(V).addClass("hover");$(".selectItemCount").scrollTop((V-2)*22)}else{if(13==U.keyCode){if(S[V]){S[V].click();$("#newTel2").focus()}}}}});var D=function(){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_xzlxdh","WT.msg","22")}var V=$.trim(I.val());var Y=$.trim(O.val());var S=$.trim(P.val());var X=$.trim(Q.val());var T=$("input[name=selPhoneId]").size();if(V==property.mobileTip){V=""}if(Y==property.areaCodeTip){Y=""}if(S==property.telephoneTip){S=""}if(!V&&!Y&&!S){base.yumTrackAlert(property.mobiTelephone);return}if(V){if(common.isMobile(V)){}else{base.yumTrackAlert(property.mobNotcorrect);return}}if(Y){if(!common.isAreaCode(Y)){base.yumTrackAlert(property.areaCodeNotCorrent);return}if(!S){base.yumTrackAlert(property.teleNotCorrent);return}}if(S){if(!common.isTelephone(S)){base.yumTrackAlert(property.teleNotCorrent);return}if(!Y){base.yumTrackAlert(property.areaCodeNotCorrent);return}}if(X){if(!/^\d+$/.test(X)){base.yumTrackAlert(property.extensionNumNotCorrent);return}}if(!F.isNewUser){var U=Y+S;if(U!=""&&X!=""){U+="-"+X}KFC_POST("/addPhones.action",{phone1:V,phone2:U},function(b){if(b.code==serviceCode.SUC_CODE){var Z=b.message.indexOf(",");if(Z!=-1){var c=b.message.substring(0,Z);var a=b.message.substring(Z+1);K.append(N.format([property.mobile+property.colon,V,c]));K.append(N.format([property.fixedPhone+property.colon,U,a]));F.phoneList.push(V);F.phoneList.push(U)}else{if(V){K.append(N.format([property.mobile+property.colon,V,b.message]));F.phoneList.push(V)}else{K.append(N.format([property.fixedPhone+property.colon,U,b.message]));F.phoneList.push(U)}}B.show();C.hide();if(!A.is(":visible")){A.removeClass("dn")}$("#phone_1 li").last().addClass("selectcolor").find("input[type=radio]").attr("checked","checked");base.yumTrackAlert(property.saveSuccessfully)}else{if(b.code=="113"){base.yumTrackAlert(property.mobileExitCantAdd)}else{if(b.code=="124"){base.yumTrackAlert(property.mobileMaxNum)}else{base.yumTrackAlert(property.saveFailed)}}}})}else{if(V){if($.inArray(V,F.phoneList)!==-1){base.yumTrackAlert(property.mobileExitCantAdd);return}K.append(N.format([property.mobile+property.colon,V,T++]));F.phoneList.push(V)}if(S){var W=Y+S;if(X){W+="-"+X}if($.inArray(W,F.phoneList)!==-1){base.yumTrackAlert(property.mobileExitCantAdd);return}K.append(N.format([property.fixedPhone+property.colon,W,T++]));F.phoneList.push(W)}B.show();C.hide();if(!A.is(":visible")){A.removeClass("dn")}if(J==null||J==""){J=V;$.ajax({dataType:"json",type:"POST",data:{phone:V},url:requestContextPath+"/hasOaddress.action",beforeSend:function(Z){},success:function(b,Z){if(b){$("#import_addr_tip").html(property.importAddress);$("#import_addr_tip").show();var a=new KFC_Osaddress();a.bindImportAddress(J)}},complete:function(a,Z){},error:function(){base.yumTrackAlert(property.BadRequest)}})}base.yumTrackAlert(property.saveSuccessfully)}L()};var G=function(){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_scnpn","WT.msg","-21")}var U=$(this);var S=U.parent().attr("deleteflag");var V=U.parent().attr("isBindPhone");if(V){base.yumTrackAlert(property.bindPhoneCantDelete);return}var T=U.parent().attr("value");if(S==1){base.yumTrackAlert(property.phoneCantDelete);return}base.yumConfirm(property.deletePhoneWarn,function(){if(F.isNewUser){var W;U.closest("li").each(function(){W=$(this).children("td").eq(1).html()});U.closest("li").remove();F.phoneList.pop();if(W==J){$("#import_addr_tip").hide()}}else{KFC_POST("/delPhone.action",{phoneId:T},function(X){if(X.code==serviceCode.SUC_CODE){U.closest("li").remove();F.phoneList.pop();customerCommonFn.savePhoneToCookie();base.yumTrackAlert(property.deleteSuccessfully)}else{if(X.code==serviceCode.UNKNOWN_SERVICE_ERROR){base.yumTrackAlert(property.serviceUnknown)}else{base.yumTrackAlert(property.deleteFailed)}}})}})};this.isFinish=function(){if(R.is(":visible")){R.click();return false}if(F.phoneList.length==1){$("input[name=selPhoneId]").each(function(){this.checked=true;$(this).parents("li").addClass("selectcolor")})}if(!$("[name=selPhoneId]:checked")[0]){base.yumTrackAlert(property.phoneNotSelected);return false}return true};R.click(D);H.live("click",G)};var emapSearcher=new base.EMapSearcher();var KFC_Address=function(z){var n=$("#cityName");var D=$("#address2");var M=$("#address3");var x=$("#addAddress");var Y=$("#address_1");var Ag=$("#delivery");var V=D.next(".new_add_img");var m=$("#addAddressBtn");var h=$("#saveAddressBtn");var l=$(".deleteAddressBtn");var Ad=$("input[name=selAddressId]");var w=$(".useThisAddress");var k=$(".setDefaultAddress");var I=$("#cancelAddressBtn");var B=$("#isCenterFlag").val();var Aa={};var Ab={};var c=new CityChoose($("#city_list"));var N=$('<div class="selectItem"><div class="selectItemCount"></div></div>');var O='<li><div style="width: 20px; float: left; margin-top: 4px;"><input name="selAddressId" type="radio" value="{4}"><input name="nCityCode" type="hidden" value="{1}"><input name="nMainaddress" type="hidden" value="{2}"><input name="nSupplementaladdress" type="hidden" value="{3}"><input name="coordinate_x" type="hidden" value="{5}"><input name="coordinate_y" type="hidden" value="{6}"><input name="addressDESFlag" type="hidden" value="1"></div><div style="float:left" class="cityName"><a name="selAddressLink" style="text-decoration: none;display: block;width: 493px;" href="javascript:void(0);">{0}&nbsp;&nbsp;&nbsp;&nbsp;{2} {3}</a></div><div style="float:right"><a href="javascript:void(0);" class="deleteAddressBtn" newaddressflag="1" tip="{2}"></a></div></li>';var C='<div tip="deliveryTime"><div class="address_span" style="height:60px;">'+property.deliveryTime+'</div><div><div style=" margin-top: 20px;height:60px"><p class="deliveryHeight"><input name="sendfoodtime" type="radio" checked="checked" tip="inTime" style="vertical-align:middle;margin:-4px 0 0;" /><a name="sendfoodtimeLink" href="javascript:void(0);" style="text-decoration: none;"><span>{3}</span><span class="bc">{0}</span>{4}</a></p><div style="position:relative;"><div class="fl_l"><input {2} class="sendfoodtime-style" name="sendfoodtime" type="radio" value="{1}" /> <a name="sendfoodtimeLink" href="javascript:void(0);" style="text-decoration: none;"><span>'+property.currentLater+'</span></a></div><div class="selectTime"></div></div></div></div></div>';if(B=="1"){var Af=$("#useThisAddressWords").text();var P=$("#deleteAddressWords").text();var o=$("#setDefaultAddressWords").text();l=$(".deleteAddress");O='<li><div style="display:none"><input name="selAddressId" type="radio" value="{4}"><input name="nCityCode" type="hidden" value="{1}"><input name="nMainaddress" type="hidden" value="{2}"><input name="nSupplementaladdress" type="hidden" value="{3}"><input name="coordinate_x" type="hidden" value="{5}"><input name="coordinate_y" type="hidden" value="{6}"><input name="addressDESFlag" type="hidden" value="1"></div><div class="cityName"><a name="selAddressLink" style="text-decoration: none;display: block;float:left" href="javascript:void(0);">{0}&nbsp;&nbsp;&nbsp;&nbsp;{2} {3}</a><div class="addressOptions"><div class="deleteAddress" newaddressflag="1">'+P+'</div><div class="setDefaultAddress">'+o+'<span>|</span></div><div class="useThisAddress">'+Af+"<span>|</span></div></div></div></li>"}var E='<input name="supportonlinepay" type="hidden" value="{0}"/>';var q='<span class="bc">'+property.bookingService+"</span>";$("#query_city").live("click",function(){c.init();$(".selectItem").hide()});$("#city_del").live("click",function(){c.close()});var e=null;var R=null;var j,u;function Z(Ah){if(e){Ah.streetName=Ah.name;j=Ah.location.getLng();u=Ah.location.getLat();e(Ah);e=null}}function L(Ai,Ah){e=Ah;R=Ai;var Aj=R.name;if(R.realname){Aj=R.realname}$('[role="dialog"]').css("left",($(window).width()-$('[role="dialog"]').width())/2+"px");$("#closeDiv").css("top",0);$("#closeDiv").css("right",0);$("#emapPopup").find("#closeDiv").live("click",function(){$("#emapPopup").dialog("close")});showEMapCommon(Aj,"1","address2",Z)}$(".selectItemCount a").live("click",function(){mapInit(httpResourcePath);if(!window.EmapOnline){$("#popAddress").text($("#address2").val());$("#new_add_error").show();$("#layer_box").show()}else{$(this).parents(".selectItem").hide();L(Aa,function(Aj){Ab=Aj});var Ai=$("#cityName").val();var Ah=$("#address2").val();_tag.dcsMultiTrack("wt.event","emap地址搜索","wt.msg","老用户查看更多","wt.emapaddress",Ai+":"+Ah)}});$("#new_add_error .close03").click(function(){$("#new_add_error").hide();$("#layer_box").hide()});$("#returnIndex").click(function(){base.setAction("index.action")});$("#inputAgain").click(function(){$("#new_add_error").hide();$("#layer_box").hide();$(".selectItem").hide();$("#address2").focus()});$("a[name=tipBtn]").live("click",function(){var Ai=0;var Ah=$(this);$("a[name=tipBtn]").each(function(Aj,Ak){if($(Ak).text()==Ah.text()){Ai=Aj;return false}});c.tipChange(Ai)});$("#city_list").find("a[name=choose_city_btn]").live("click",function(){var Ah=$(this);Aa={};Aa.citycode=Ah.attr("citycode");Aa.id=Ah.attr("cityId");Aa.name=Ah.attr("cityname");Aa.districtName=Ah.attr("districtName");Aa.realname=Ah.attr("realname");$("#cityName").val(Ah.attr("cityname"));c.close();X({element:n,value:Aa.name,districtName:Aa.districtName,data:Aa})();D.val(property.mainAddressTip)});var X=function(){var Al=arguments[0];var Aj=Al.element;var Ai=Al.value;var Ah=Al.data;var Ak=Al.districtName;return function(){if(Ak){if(Ai=="杭州"){$("#userInfoBrand").show()}else{if(!y()){$("#userInfoBrand").hide()}}Ai=Ak+"("+Ai+")"}else{if(Ai=="杭州"){$("#userInfoBrand").show()}else{if(!y()){$("#userInfoBrand").hide()}}}Aj.val(Ai);N.remove();Aj==n?Aa=Ah:Ab=Ah;if(Ah.citycode){var Am=p(Ah.citycode)}else{if(Ah.res&&Ah.res.toUpperCase()=="MAPABC"){base.yumAlertBack(property.addressNotInDelivery,function(){mapInit(httpResourcePath);if(!window.EmapOnline){$("#popAddress").text($("#address2").val());$("#new_add_error").show();$("#layer_box").show()}else{$(this).parents(".selectItem").hide();L(Aa,function(Ap){Ab=Ap});var Ao=$("#cityName").val();var An=$("#address2").val();_tag.dcsMultiTrack("wt.event","emap地址搜索","wt.msg","老用户查看更多","wt.emapaddress",Ao+":"+An)}});N.remove();return true}}}};var p=function(Ai){var Ah="";for(cityDomIndex in c.cityListDom){var Aj=c.cityListDom[cityDomIndex];var Ak=Aj.find("a");if(Ak.attr("citycode")==Ai){Ah=Ak.attr("realname");return Ah}}return Ah};var y=function(){if($("#addAddress").css("display")!="none"&&$("#cityName").val().indexOf("杭州")!=-1){return true}var Ah=$(".cityName");var Ai=false;Ah.each(function(){if(this.innerHTML.indexOf("杭州")!=-1){Ai=true;return}});return Ai};var A=function(){n.val(property.cityTip);D.val(property.mainAddressTip);M.val(property.suppleMentalAddressTip)};n.tip(property.cityTip);D.tip(property.mainAddressTip);M.tip(property.suppleMentalAddressTip);Ad.each(function(){z.addressList.push(this.value)});n.keyup(function(Ah){c.close();var Ai=$.trim(this.value);Ai=Ai.replace(/[^\a-zA-Z\u4E00-\u9FA5]/g,"");if(Ai&&(!common.isStr(Ai)||common.isStr2(Ai,1))){N.remove();base.yumTrackAlert(property.invaildStringError);return}if((Ah.keyCode>=65&&Ah.keyCode<=90)||(Ah.keyCode>=48&&Ah.keyCode<=57)||Ah.keyCode==32||Ah.keyCode==8){N.css({top:"25px",left:"0px"});if(Ai&&Ai!=property.cityTip){N.find(".selectItemCount").html('<img src="res/images/loading.gif"/>');$(this).after(N.show());$.ajax({url:requestContextPath+"/queryCity.action",data:{cityName:Ai},type:"post",dataType:"json",beforeSend:function(){},success:function(Ak){$(".selectItemCount").data("current",-1);var Am=$("<ul></ul>");if(Ak&&Ak.length>0){for(var Ao in Ak){var An=Ak[Ao];var Al=An.name+An.nameen;if(An.districtName){Al=An.districtName+"("+An.name+")"+An.pinYinName}var Aj=$("<li>"+Al+"</li>");Aj.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});Aj.click(X({element:n,value:An.name,districtName:An.districtName,data:An}));Am.append(Aj)}}else{Am.append("<li>"+property.noMatch+"</li>")}N.find(".selectItemCount").html("").append(Am)},complete:function(Ak,Aj){},error:function(){base.yumTrackAlert(property.BadRequest)}})}else{N.remove();Aa={}}}}).keydown(function(Aj){var Ah=$(".selectItemCount").find("li"),Ak=$(".selectItemCount").data("current")||0,Ai=Ah.length;if(9==Aj.keyCode){if(1==Ai){Ah.first().click()}}else{if(38==Aj.keyCode||40==Aj.keyCode){if(38==Aj.keyCode){Ak=Ak>0?Ak-1:Ai-1}else{if(40==Aj.keyCode){Ak=Ak<Ai-1?Ak+1:0}}$(".selectItemCount").data("current",Ak).find("li").removeClass("hover").eq(Ak).addClass("hover");$(".selectItemCount").scrollTop((Ak-2)*22)}else{if(13==Aj.keyCode){if(Ah[Ak]){Ah[Ak].click();$("#address2").focus()}}}}});n.change(function(){if(!this.value){Aa={}}Ab={};D.val(property.mainAddressTip)});$("#address2").keyup(function(Ah){if((Ah.keyCode>=65&&Ah.keyCode<=90)||(Ah.keyCode>=48&&Ah.keyCode<=57)||Ah.keyCode==32||Ah.keyCode==8){$(".selectItemCount").data("current",-1);U();checkTime()}}).keydown(function(Aj){var Ah=$(".selectItemCount").find("li"),Ak=$(".selectItemCount").data("current")||0,Ai=Ah.length;if(38==Aj.keyCode||40==Aj.keyCode){if(38==Aj.keyCode){Ak=Ak>0?Ak-1:Ai-1}else{if(40==Aj.keyCode){Ak=Ak<Ai-1?Ak+1:0}}$(".selectItemCount").data("current",Ak).find("li").removeClass("hover").eq(Ak).addClass("hover");$(".selectItemCount").scrollTop((Ak-2)*22)}else{if(13==Aj.keyCode){if(Ah[Ak]){Ah[Ak].click();$("#address3").focus()}}}}).keypress(function(){Ab={}}).focus(function(){var Ah=$(".selectItemCount").find("li"),Ai=Ah.length;if(1==Ai){Ah.first().click()}});var i="0";function U(){theD=new Date();stime=theD.getTime();i="0"}function v(Ah){return Ah.replace(/[^\x00-\xff]/g,"xx").length}window.checkTime=function(){newD=new Date();etime=newD.getTime();if(i=="0"){j="";u="";if((etime-stime)>=autonavi_yum.interval){if(v($("#address2").val())>2){i="1";H()}}else{clearTimeout(Ah);var Ah=setTimeout("checkTime()",2);Ah}}};function H(){var Ah=$.trim(D.val());if(!Aa.hasOwnProperty("citycode")){base.yumTrackAlert(property.pleaseChooseCityFirst);return}if(""==Ah||Ah==property.mainAddressTip){base.yumTrackAlert(property.communityDescNotNull);return}if(common.isStr2(Ah,3)){N.remove();base.yumTrackAlert(property.invaildStringError);return}if(window.EmapOnline){W(Ah,Q)}else{Ac(Ah)}}function Q(Ao){if(Ao==null||Ao==""){return}var Aq=Ao.status;if(Aq&&Aq.code!="0"){return}var Ak=Ao.data;var Ap=$("<ul></ul>");if(Ak&&Ak.length>0){var An=0;var Aj=Ak.length;for(var Al in Ak){An++;var Ah=Ak[Al];Ah.streetName=Ah.address;var Am="";if(An<Aj){Am=$("<li>"+Ah.address+"</li>")}else{Am=$('<li style="margin-bottom:15px;">'+Ah.address+"</li>")}Am.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});Am.click(X({element:D,value:Ah.address,data:Ah}));Ap.append(Am)}}var Ai=$('<li class="findMap">'+property.notFindClick+"<a>"+property.notFindMore+"</a></li>");var Ar=$(".selectItemCount").height();if(Ar<=300){Ap.height("6px");Ai.width("100%")}Ap.append(Ai);N.find(".selectItemCount").html("").append(Ap)}function W(Aj,Ah){N.css({top:"37px",left:"253px"});N.find(".selectItemCount").html('<img src="res/images/loading.gif">');D.after(N.show());var Ai=p(Aa.citycode);$.ajax({url:autonavi_yum.hostAddr,dataType:"jsonp",data:{sid:1012,cityName:Ai,address:Aj,size:30,brands:"KFC",encode:autonavi_yum.charencode,callback:"?"},type:"GET",beforeSend:function(){},success:function(Ak){if(Ah&&$.isFunction(Ah)){Ah(Ak)}},complete:function(Al,Ak){},error:function(){base.yumAlert(property.BadRequest)}})}function Ac(Ai,Ah){N.css({top:"37px",left:"253px"});N.find(".selectItemCount").html('<img src="res/images/loading.gif">');D.after(N.show());Ah=Ah||"false";$.ajax({url:requestContextPath+"/searchAddressList.action",data:{cityCode:Aa.citycode,streetName:Ai,saveFlag:Ah},type:"post",dataType:"json",beforeSend:function(){},success:function(Al){var An=$("<ul></ul>");if(Al&&Al.code==serviceCode.TOO_MANY_RESULTS){An.append('<li style="margin-bottom:15px;">'+property.tooManyResults+"</li>")}else{if(Al&&Al.code==10014){base.yumAlertBack(property.userNotFound,function(){base.setActionHttps("orderLogin.action")});return}else{var Ak=0;var Ao=Al.length;if(Al&&Al.length>0){for(var Ap in Al){Ak++;var Am=Al[Ap];var Aj="";if(Ak<Ao){Aj=$("<li>"+Am.streetName+"</li>")}else{Aj=$('<li style="margin-bottom:15px;">'+Am.streetName+"</li>")}Aj.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});Aj.click(X({element:D,value:Am.streetName,data:Am}));An.append(Aj)}}}}if(An.children(Aj).length>0){N.find(".selectItemCount").html("").append(An)}else{D.after(N.hide())}},complete:function(Ak,Aj){},error:function(){base.yumTrackAlert(property.BadRequest)}})}V.click(H);D.focus(function(){});D.blur(function(){var Ah=$(".selectItemCount>ul>li").size();if(Ah<=1){var Ai=$.trim(D.val());if($(".ui-dialog").css("display")=="block"){return}if(common.isStr2(Ai,1)){base.yumTrackAlert(property.invaildStringError);return}if(!Aa.hasOwnProperty("citycode")){base.yumTrackAlert(property.pleaseChooseCityFirst);return}if(property.mainAddressTip!=Ai&&null!=Ai&&""!=Ai){H()}}});D.change(function(){});var f=function(){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_syxdz","WT.msg","23")}A();$(this).hide();var Ah=$(this).attr("id");if(Ah!="addressAdd"){x.find("#addressAdd").hide()}x.show();$(".info_table").find("tr[tip=deliveryTime]").hide();$("input[name=selAddressId]").each(function(){this.checked=false});if(B=="1"){return}$("#address_1 li").removeClass("selectcolor td_no_border")};var s=function(){x.hide();m.show();Y.show();Y.find(".fl_l").show();if(!y()){$("#userInfoBrand").hide()}m.show()};var K=function(){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_bcxdz","WT.msg","24")}if(!Aa.hasOwnProperty("id")){base.yumTrackAlert(property.pleaseChooseCityFirst);return}if(!Ab.hasOwnProperty("id")){base.yumTrackAlert(property.pleaseChooseMainAddress);return}var Aj=$.trim(n.val());var An=$.trim(D.val());var Am=$.trim(M.val());var Ak=/^(?=.*?[!@#$%^&*、<>《》,\\\/\[\]\'\;\=+！＃￥……]).*$/;var Ah=$("input[name=selAddressId]").size();var Ai=function(Ar){var Aq=Aa.name;if(Aa.realname){Aq=Aa.realname}$addressTemp=$(O.format([Aq,Aa.citycode,Ab.streetName,Am,Ar,j,u]));Y.find("ul").append($addressTemp);x.hide();Y.show();Y.find(".fl_l").show();if(!y()){$("#userInfoBrand").hide()}$addressTemp.find("input[name='selAddressId']").prop("checked",true).click();m.show()};if(""==Aj||Aj==property.cityTip){base.yumTrackAlert(property.cityNotNull);return false}if(""==An||An==property.mainAddressTip){base.yumTrackAlert(property.communityNotNull);return false}if(""==Am||Am==property.suppleMentalAddressTip){base.yumTrackAlert(property.suppleMentalAddressStart);return false}if(Ak.test(Am)){base.yumTrackAlert(property.addressFalse);return false}var Ap=Am.replace(/[^\x00-\xff]/g,"xx").length;if(Ap>=60){base.yumTrackAlert(property.suppleMentalAddressTooLong);return}if(common.isStr2(Am,1)||common.isStr2(An,1)||common.isStr2(Aj,1)){base.yumTrackAlert(property.invaildStringError);return false}var Ao=null;if(!z.isNewUser){KFC_POST("/addAddress.action",{cityId:Aa.citycode,mainAddress:An,supplementaladdress:Am,coordinate_x:j,coordinate_y:u},function(Aq){if(Aq.code==serviceCode.SUC_CODE){Ai(Aq.message);base.yumTrackAlert(property.saveSuccessfully);z.addressList.push(Aq.message)}else{if(Aq.code==serviceCode.OUT_OF_ADDR_DELIVERY){base.yumAlertBack(property.addressNotInDelivery,function(){mapInit(httpResourcePath);if(!window.EmapOnline){$("#popAddress").text($("#address2").val());$("#new_add_error").show();$("#layer_box").show()}else{$(this).parents(".selectItem").hide();L(Aa,function(At){Ab=At});var As=$("#cityName").val();var Ar=$("#address2").val();_tag.dcsMultiTrack("wt.event","emap地址搜索","wt.msg","老用户查看更多","wt.emapaddress",As+":"+Ar)}})}else{if(Aq.code=="114"){base.yumTrackAlert(property.addressExitCantAdd)}else{if(Aq.code=="125"){base.yumTrackAlert(property.addressMaxNum)}else{if(Aq.code=="25"){base.yumTrackAlert(codeMessage.error25)}else{if(Aq.code=="10013"){base.yumTrackAlert(property.addrStartWithNum)}else{if(Aq.code==serviceCode.UNKNOWN_SERVICE_ERROR){base.yumTrackAlert(property.serviceUnknown)}}}}}}}})}else{for(var Al in z.addressList){if(z.addressList[Al]==Aa.citycode+Ab.streetName+Am){base.yumTrackAlert(property.addressExitCantAdd);return}}KFC_POST("/addAddressNew.action",{cityCode:Aa.citycode,supplementaladdress:Am,mainAddress:An,coordinate_x:j,coordinate_y:u},function(Aq){if(Aq.code==serviceCode.SUC_CODE){Ai(Ah);z.addressList.push(Aa.citycode+Ab.streetName+Am);base.yumTrackAlert(property.saveSuccessfully)}else{if(Aq.code==serviceCode.OUT_OF_ADDR_DELIVERY){base.yumAlertBack(property.addressNotInDelivery,function(){mapInit(httpResourcePath);if(!window.EmapOnline){$("#popAddress").text($("#address2").val());$("#new_add_error").show();$("#layer_box").show()}else{$(this).parents(".selectItem").hide();L(Aa,function(At){Ab=At});var As=$("#cityName").val();var Ar=$("#address2").val();_tag.dcsMultiTrack("wt.event","emap地址搜索","wt.msg","老用户查看更多","wt.emapaddress",As+":"+Ar)}})}else{if(Aq.code=="24"){base.yumTrackAlert(codeMessage.error24)}else{if(Aq.code=="25"){base.yumTrackAlert(codeMessage.error25)}else{if(Aq.code=="114"){base.yumTrackAlert(property.addressExitCantAdd)}else{if(Aq.code=="125"){base.yumTrackAlert(property.addressMaxNum)}else{if(Aq.code==serviceCode.UNKNOWN_SERVICE_ERROR){base.yumTrackAlert(property.serviceUnknown)}}}}}}}})}};var T=function(){if(B=="1"){return}$("#address_1").find(".selectcolor").each(function(As,At){$(At).removeClass("selectcolor")});$(this).parents("li").addClass("selectcolor");x.hide();m.show();N.remove();var Ai=$(this);var Aq=Ai.attr("deliverytime");Ai.closest("ul").find(".td_no_border").removeClass("td_no_border");$("#adderssArea").next("[tip=deliveryTime]").remove();var Ap=Ai.parent();var An=Ap.find("input[name=nSupplementaladdress]").val();var Ao=Ap.find("input[name=nCityCode]").val();var Am=Ap.find("input[name=addressDESFlag]").val();var Ah=Ap.find("input[name=nMainaddress]").val();var Aj=Ap.find("input[name=coordinate_x]").val();var Ak=Ap.find("input[name=coordinate_y]").val();var Al=Ai.val();if(z.isNewUser){Al=Ao+","+An+","+Ah+","+Aj+","+Ak}if(Aq&&Aq!=""){var Ar=$(C.format([Aq,Al]));Ai.closest("li").addClass("td_no_border");$("#adderssArea").remove("tr[tip=deliveryTime]");$("#adderssArea").after(Ar);Ag.val(Aq);if($('input[name="sendfoodtime"]:checked').attr("tip")=="inTime"){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_order1","WT.msg","25")}}else{if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_order2","WT.msg","25")}}return}else{KFC_POST("/getDeliveryTime.action",{cityCode:Ao,supplementaladdress:An,nMainaddress:Ah,addressDESFlag:Am,coordinate_x:Aj,coordinate_y:Ak},function(Au){var Ax=true;if(Au.code==serviceCode.SUC_CODE||Au.code==serviceCode.BOOKING_OUT_OF_STORE_TIME){var As=Au.message.split(",");var Aw="";if(Au.code==serviceCode.SUC_CODE){Aw=As.length>3?$(C.format([As[0],"","disabled",property.afterSubmit,property.timeArrive])):$(C.format([As[0],Al,"",property.afterSubmit,property.timeArrive]))}if(Au.code==serviceCode.BOOKING_OUT_OF_STORE_TIME){base.yumTrackAlert(property.bookingTimeWarn.format([As[2],q]));Aw=As.length>3?$(C.format(["","","disabled",property.outOfBuinessHours.format([As[2]]),""])):$(C.format(["",Al,"",property.outOfBuinessHours.format([As[2]]),""]))}Ai.closest("li").addClass("td_no_border");$("#adderssArea").after(Aw);var At=$(E.format([As[1]]));if(Ap.find("input[name=supportonlinepay]")){Ap.find("input[name=supportonlinepay]").remove()}Ai.after(At);Ag.val(As[0]);if(Au.code==serviceCode.BOOKING_OUT_OF_STORE_TIME){$("#adderssArea").next().find('input[type="radio"]:first').attr("checked",false);$("#adderssArea").next().find('input[type="radio"]:first').attr("disabled","disabled");$("#adderssArea").next().find('input[type="radio"]:last').attr("checked",true);$("#adderssArea").next().find('input[type="radio"]:last').trigger("click");Ax=false}}else{if(Au.code=="27"){base.yumTrackAlert(property.storeStop)}else{if(Au.code=="25"){base.yumTrackAlert(property.addressNotInDeliveryHelp)}else{if(Au.code=="1"){base.yumTrackAlert(property.storeClosed)}else{if(Au.code==serviceCode.STORE_CLOSED){base.yumTrackAlert(Au.message)}else{if(Au.code=="26"){base.yumTrackAlert(Au.message)}else{if(Au.code==10014){base.yumAlertBack(property.userNotFound,function(){base.setActionHttps("orderLogin.action")});return}else{base.yumTrackAlert(property.addressNotInDeliveryHelp)}}}}}}Ag.val("");Ai[0].checked=false}var Av=$('input[name="sendfoodtime"]:checked');if(Ax&&Av.size()>0){if(Av.attr("tip")=="inTime"){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_order1","WT.msg","25")}}else{if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_order2","WT.msg","25")}}}})}};var Ae=function(Ai){var Ao="<span/>";var As="<div/>";var Ap="<ul/>";var Ak="<li/>";var An='<input type="hidden"/>';var Am=Ai.currentTime;var Al=Ai.isSecondDay;var Ah=[];var Aj=(function(){var Au=Ai.timeList;var Aw={};for(var At in Au){var Ax=Au[At].hour;var Av=Au[At].minutes;Ah.push(Ax);Aw[Ax]=Av}return Aw})();var Aq=function(Ay){var Av=Aj[Ay];var Az=$(As).addClass("macstyle");var Aw=$(As).addClass("tag_select").text(Av[0]);var At=$(Ap).addClass("tag_options");var AA=$(An).attr("name","minute").val(Av[0]);for(var Ax in Av){var Au=$(Ak).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(){Aw.text($(this).text());AA.val($(this).text());At.hide()});At.append(Au.text(Av[Ax]))}Aw.click(function(){At.show()});return Az.append(Aw,At,AA)};var Ar=function(){var Ax=$(As).addClass("macstyle");var Az=$(As).addClass("tag_select").text(Ah[0]);var Av=$(Ap).addClass("tag_options");var Ay=$(An).attr("name","hour").val(Ah[0]);var At=function(){$(this).closest(".macstyle").siblings(".macstyle").after(Aq($(this).text())).remove();Az.text($(this).text());Ay.val($(this).text());Av.hide()};for(var Au in Ah){var Aw=$(Ak).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(At);Av.append(Aw.text(Ah[Au]))}Az.click(function(){Av.show()});return Ax.append(Az,Av,Ay)};this.getHtml=function(){var Ax=new Date();currentTimeEn=Ax.getFullYear()+"/"+(Ax.getMonth()+1)+"/"+Ax.getDate();currentTimeCn=Ax.getFullYear()+"年"+(Ax.getMonth()+1)+"月"+Ax.getDate()+"日";var At=$(Ao).text($.localStr({cn:currentTimeCn,en:currentTimeEn},1));var Au=$(Ao).text(property.hour);var Av=$(Ao).text(property.min);var Aw=$(An).attr("name","isSecondDay").val(Al);return $("<div/>").append(At,Ar(),Au,Aq(Ah[0]),Av,Aw)}};$("input[name=sendfoodtime]").live("click",function(){var Aj=$(this);var Al=$(".selectTime");var Ai=$(this).attr("tip");if(Ai&&Ai=="inTime"){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_order1","WT.msg","25")}Al.empty().hide()}else{if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_order2","WT.msg","25")}var Ah=this.value;var Am={addressId:Ah};if(z.isNewUser){var Ak=Ah.split(",");if(!Ak[0]||!Ak[1]||!Ak[2]){throw new Error('"/getTimeByStore.action" parameters is null')}Am={cityCode:Ak[0],supplementaladdress:Ak[1],mainAddress:Ak[2],coordinate_x:Ak[3],coordinate_y:Ak[4]}}KFC_POST("/getTimeByStore.action",Am,function(An){if(An.timeList&&An.timeList.length>0){var Ao=new Ae(An);Al.empty().append(Ao.getHtml()).show()}else{if(An&&An.code==serviceCode.OUT_OF_DELIVERY_TIME){base.yumTrackAlert(An.message);Aj.closest("td").find("[name=sendfoodtime]:first").click()}else{if(An&&An.code==serviceCode.ADDR_NOT_FIND){base.yumTrackAlert(property.notFindAddress);Aj.closest("td").find("[name=sendfoodtime]:first").click()}else{base.yumTrackAlert(property.serviceUnknown);Aj.closest("td").find("[name=sendfoodtime]:first").click()}}}})}});$("[name=sendfoodtimeLink]").live("click",function(){var Aj=$(this).prev("[name=sendfoodtime]");$("[name=sendfoodtime]").each(function(An,Ao){$(Ao).attr("checked","false")});Aj.attr("checked","true");var Al=$(".selectTime");var Ai=Aj.attr("tip");if(Ai&&Ai=="inTime"){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_order1","WT.msg","25")}Al.empty().hide()}else{if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_order2","WT.msg","25")}var Ah=Aj[0].value;var Am={addressId:Ah};if(z.isNewUser){var Ak=Ah.split(",");if(!Ak[0]||!Ak[1]||!Ak[2]){throw new Error('"/getTimeByStore.action" parameters is null')}Am={cityCode:Ak[0],supplementaladdress:Ak[1],mainAddress:Ak[2],coordinate_x:Ak[3],coordinate_y:Ak[4]}}KFC_POST("/getTimeByStore.action",Am,function(An){if(An.timeList&&An.timeList.length>0){var Ao=new Ae(An);Al.empty().append(Ao.getHtml()).show();$("#nextTr").show()}else{if(An&&An.code==serviceCode.OUT_OF_DELIVERY_TIME){base.yumTrackAlert(An.message);Aj.closest("td").find("[name=sendfoodtime]:first").click()}else{if(An&&An.code==serviceCode.ADDR_NOT_FIND){base.yumTrackAlert(property.notFindAddress);Aj.closest("td").find("[name=sendfoodtime]:first").click()}else{base.yumTrackAlert(property.serviceUnknown);Aj.closest("td").find("[name=sendfoodtime]:first").click()}}}})}});var F=function(){var Ah=true;$.ajax({url:requestContextPath+"/delOsAddrAction.action",async:false,data:{},dataType:"json",type:"post",success:function(Ai){if(Ai.code==serviceCode.FAIL_CODE){Ah=false}}});return Ah};var S=function(){var Ah=this;a(this)};var a=function(Al){var Ai=$($(Al).parents("li")[0]).find("input[name=selAddressId]");var Ap=Ai.parent();var An=Ap.find("input[name=nSupplementaladdress]").val();var Ao=Ap.find("input[name=nCityCode]").val();var Am=Ap.find("input[name=addressDESFlag]").val();var Ah=Ap.find("input[name=nMainaddress]").val();var Ak=Ap.find("input[name=coordinate_x]").val();var Aj=Ap.find("input[name=coordinate_y]").val();KFC_POST("/getDeliveryTime.action",{cityCode:Ao,supplementaladdress:An,nMainaddress:Ah,addressDESFlag:Am,coordinate_x:Ak,coordinate_y:Aj},function(As){if(As.code==serviceCode.SUC_CODE||As.code==serviceCode.BOOKING_OUT_OF_STORE_TIME){var Aq=As.message.split(",");var Ar=Ai.val();$.cookie("orderAddressFromCustomerCenter",Ar,{path:"/"});window.location.href=requestContextPath+"/returnCustomer.action";return}else{if(As.code=="27"){base.yumTrackAlert(property.storeStop)}else{if(As.code=="25"){base.yumTrackAlert(property.addressNotInDeliveryHelp)}else{if(As.code=="1"){base.yumTrackAlert(property.storeClosed)}else{if(As.code==serviceCode.STORE_CLOSED){base.yumTrackAlert(As.message)}else{if(As.code=="26"){base.yumTrackAlert(As.message)}else{if(As.code==10014){base.yumAlertBack(property.userNotFound,function(){base.setActionHttps("orderLogin.action")});return}else{base.yumTrackAlert(property.addressNotInDeliveryHelp)}}}}}}}})};var t=function(){var Ai=$(this);var Ah=$(Ai.parents("li")[0]).find("input[name=selAddressId]").val();KFC_POST("/setDefaultAddress.action",{addressId:Ah},function(Aj){if(Aj.code==serviceCode.SUC_CODE){g($(Ai.parents("li")[0]));base.yumTrackAlert(property.defaultAddressSetSuccessful)}else{if(Aj.code==serviceCode.USER_NOT_LOGIN){location.href=requestContextPathHttps+"/orderLogin.action"}else{base.yumTrackAlert(property.serviceUnknown)}}})};var g=function(Ai){var Aj=$("#defaultWords").text();var Ah='<span class="showDefault">('+Aj+")</span>";$(".selectcolor").removeClass("selectcolor");$(".setDefaultAddress").show();$(".showDefault").remove();Ai.addClass("selectcolor");Ai.find(".setDefaultAddress").hide();Ai.find(".cityName>a").append(Ah)};var J=function(){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","XXQR_KFC_scxdz","WT.msg","-23")}var Ao=$(this);var Al=Boolean(Ao.attr("needMailFlag"));var Ai=!!Ao.attr("isos");var Ah=function(){var Aq=$(Ao.parents("li")[0]);if($("#adderssArea").next()[0]&&$("#adderssArea").next().attr("tip")=="deliveryTime"){$("#adderssArea").next().remove()}Aq.remove();if(!y()){$("#userInfoBrand").hide()}if(B!="1"){customerCommonFn.saveAddressToCkooie()}};if(Ai){var Am=$('<input style="margin:0 5px" type="text"/>');var An=$("<button>"+pageMessage.base_confirm+"</button>");var Aj=$('<button style="margin-left:10px;">'+pageMessage.base_cancle+"</button>");var Ap=$('<div style="text-align:left;margin:20px 0 15px;padding-left:20px;">'+property.validateCode+":</div>").append(Am);Ap=$("<div/>").append(Ap,An,Aj);Aj.click(function(){Ap.remove()});An.click(function(){var Aq=Am.val();if($.trim(Aq)==""){base.yumTrackAlert(property.codeNotNull);return}KFC_POST("/delOsAddress.action",{newCode:$.trim(Aq),oaddressid:Ao.attr("isos")},function(Ar){if(Ar.code==serviceCode.SUC_CODE){Ah();z.addressList.pop();base.yumTrackAlert(property.deleteSuccessfully)}else{if(Ar.code==serviceCode.AUTH_CODE_UNCORRECT){base.yumTrackAlert(property.EorInputCode)}else{base.yumTrackAlert(property.serviceUnknown)}}Ap.dialog("close")})});var Ak=$('<div><p style="margin-top:20px;">'+property.msgSending+"...</p></div>").dialog({title:pageMessage.customer_remind,resizable:false,modal:true,closeOnEscape:true,dialogClass:"ui-alert",close:function(){$(this).remove()},position:{my:"center",at:"center",of:window,collision:"fit"}});if(F()){setTimeout(function(){Ak.remove();Ap.dialog({title:pageMessage.customer_remind,resizable:false,modal:true,closeOnEscape:true,dialogClass:"ui-alert",close:function(){$(this).remove()},position:{my:"center",at:"center",of:window,collision:"fit"}})},3000)}else{setTimeout(function(){Ak.remove();base.yumTrackAlert(property.sendFailed)},3000)}}else{base.yumConfirm(property.deleteAddressWarn,function(){var Aq=Ao.parents("li").find("input[name=selAddressId]").val();var Ar=Ao.attr("newaddressflag");if(!z.isNewUser){if(Aq){KFC_POST("/delAddress.action",{addressId:Aq,sendFlag:Al,newaddressflag:Ar},function(As){if(As.code==serviceCode.SUC_CODE){Ah();z.addressList.pop();base.yumTrackAlert(property.deleteSuccessfully)}else{if(As.code==serviceCode.DEL_ADDR_CODE){base.yumTrackAlert(property.addressDel.format([z.userEmail]))}else{if(As.code==serviceCode.BIND_PHONE_CUSTOMER){customerCommonFn.inputBlur();customerCommonFn.inputFocus();var At=$(customerCommonFn.htmlTemp.format([As.message]));At.find("#verificationCode").click(function(){var Au=$("#verificationCode").find("img");customerCommonFn.refreshCode(Au)});At.find("#verificationCodeRefesh").click(function(){var Au=$("#verificationCode").find("img");customerCommonFn.refreshCode(Au)});At.find("#getSmsCode").click(function(){if($(this).data("dis")){return}var Av=$(".pop_con input[name=code]");var Ax=$.trim(Av[0].value);if(Ax==""||property.inputImageCode==Ax){At.find(".tipMessage").text(property.inputImageCode);return}var Au=$(this).get(0);var Aw="/customerSmsCode.action";var Ay={};Ay.imageCode=Ax;customerCommonFn.getSmsCaptcha(Au,Ay,Aw)});base.yumAlertBindPhoneVaild(At,function(){var Av=$(".pop_con input[name=code]");var Au=$.trim(Av[1].value);if(Au==""||Au==property.inputCode){At.find(".tipMessage").text(property.inputCode);return}KFC_POST("/delAddressToBindPhone.action",{addressId:Aq,code:Au},function(Aw){if(Aw.code==serviceCode.SUC_CODE){Ah();z.addressList.pop();$('a[role="button"]:visible').click();base.yumTrackAlert(property.deleteSuccessfully)}else{if(Aw.code==serviceCode.PHONE_CODE_UNCORRECT){base.yumTrackAlertBack(property.EorInputCode,function(){Av.val("").focus()})}else{if(Aw.code==serviceCode.VERIFY_VERIFICATION_CODE_ERROR){base.yumTrackAlert(property.EorNmuCode)}else{base.yumTrackAlert(property.serviceUnknown)}}}})})}else{base.yumTrackAlert(property.emailSendFail)}}}})}}else{Ah();z.addressList.pop();base.yumTrackAlert(property.deleteSuccessfully)}},null,"true")}};this.isFinish=function(){if(h.is(":visible")){h.click();return false}if(z.addressList.length==1&&(!$("[name=selAddressId]:checked")[0])){$("input[name=selAddressId]").each(function(){this.checked=true;$(this).click();$(this).parent().parent().addClass("selectcolor")});return false}if(!$("[name=selAddressId]:checked")[0]){base.yumTrackAlert(property.addressNotSelect);return false}return true};this.flagOpenOline=function(){if($("[name=selAddressId]:checked")[0]){return $("[name=selAddressId]:checked").next("input[name=supportonlinepay]").val()}};m.click(f);Ad.live("click",T).each(function(){if($(this).is(":checked")){}});$("[name=selAddressLink]").live("click",function(){if(B=="1"){return}var Ah=$(this).parent().parent().find("[name=selAddressId]");$(this).parent().parent().parent().children().each(function(Ai,Aj){$(Aj).removeClass("selectcolor")});Ah.click();Ah.parent().parent().addClass("selectcolor")});var b=navigator.appVersion;var G=b.search(/MSIE 6/i)!=-1;var d=b.search(/MSIE 7/i)!=-1;if(d||G){var r=$(".cityName");r.live("mouseover",function(){$(this).children(".addressOptions").show()}).live("mouseout",function(){$(this).children(".addressOptions").hide()})}l.live("click",J);h.click(K);if(B=="1"){w.die("click").live("click",S);k.die("click").live("click",t);I.click(s)}};var KFC_Osaddress=function(){var A='<tr><td>{0}</td><td>{2}</td><td align="center"><input name="selAddressId" type="radio" value="{5}"><input name="nCityCode" type="hidden" value="{1}"><input name="nMainaddress" type="hidden" value="{2}"><input name="nSupplementaladdress" type="hidden" value="{3}"><input name="nStoreId" type="hidden" value="{4}"></td><td align="center"><a href="javascript:;" class="deleteAddressBtn" isos="{6}" needmailflag="{7}"><img src="res/images/delete_icon_2.gif"></a></td></tr>';this.bindImportAddress=function(D){$("#import_addr_btn").click(function(){var E=KFC_Phone.firstAddPhone?property.importAddressMobile1.format([D]):property.importAddressMobile2.format([D]);base.yumConfirm(E,function(){$.ajax({dataType:"json",type:"POST",data:{mobi:D},url:requestContextPath+"/sendCaptcha.action",beforeSend:function(F){},success:function(G,F){if(G.code==serviceCode.SUC_CODE){B(D)}else{if(G.code==serviceCode.UNKNOWN_SERVICE_ERROR){base.yumTrackAlert(property.sendFailed)}else{if(G.code==serviceCode.CAPTCHA_OUTTIME1){base.yumTrackAlert(property.sendSMSMore)}else{if(G.code==serviceCode.CAPTCHA_OUTTIME2){base.yumTrackAlert(property.sendSMSMore2)}else{base.yumTrackAlert(property.sendFailed)}}}}},complete:function(G,F){},error:function(){base.yumTrackAlert(property.sendFailed)}})})})};var B=function(D){var F=60;$("#phoneNo").text(D);var E=$("#sms_popup");$("#dialog-message-sms").html(E.html());$("#dialog-message-sms").dialog({resizable:false,height:180,width:400,title:property.moblieIdentification,closeBtn:true,dialogClass:"sms_popup_bg",position:{my:"center",at:"center",of:window,collision:"fit"},modal:true});function G(){F--;$(".count_sms:visible").text(property.sendSMSAgain.format([F]));if(F<=0||countFlag==false){F=60;$(".count_sms").hide();$(".count_sms").text(property.sendSMSAgain.format("60"));$(".send_sms_code").show();return}window.setTimeout(G,1000)}if(F==60){$(".count_sms").show();$(".send_sms_code").hide();countFlag=true;G()}else{F=60}$(".vali_phone_btn").unbind("click").bind("click",function(){var H=$.trim($(".phoneCode:visible").val());if(H==""){base.yumTrackAlert(property.pleaseFillInCode);return}$.ajax({dataType:"json",type:"POST",data:{smsCode:H,mobile:D},url:requestContextPath+"/validateSMS.action",beforeSend:function(I){},success:function(J,I){if(J.code==serviceCode.SUC_CODE){C(D);$("#dialog-message-sms").dialog("close")}else{if(J.code==serviceCode.UNKNOWN_SERVICE_ERROR){base.yumTrackAlert(property.BadRequest)}else{base.yumTrackAlert(property.smsValidationCodeIncorrect);$(".phoneCode:visible").val("")}}},complete:function(J,I){},error:function(){base.yumTrackAlert(property.BadRequest)}})});$(".close_sms_btn").unbind("click").bind("click",function(){$("#dialog-message-sms").dialog("close");countFlag=false});$(".send_sms_code").unbind("click").bind("click",function(){$.ajax({dataType:"json",type:"POST",data:{mobi:D},url:requestContextPath+"/sendCaptcha.action",beforeSend:function(H){},success:function(I,H){if(I.code==serviceCode.SUC_CODE){$(".count_sms").show();$(".send_sms_code").hide();G()}else{if(I.code==serviceCode.CAPTCHA_OUTTIME1){$(".sms_validate_main").find(".sms_tip").text(property.sendSMSMoreDay).show();$(".sms_validate_main").find(".send_sms").hide()}else{if(I.code==serviceCode.CAPTCHA_OUTTIME2){$(".sms_validate_main").find(".sms_tip").text(property.sendSMSMorePeriod).show();$(".sms_validate_main").find(".send_sms").hide()}else{base.yumTrackAlert(property.sendFailed)}}}},complete:function(I,H){},error:function(){base.yumTrackAlert(property.sendFailed)}})});$(".sms_validate_main").find(".sms_tip").hide();$(".sms_validate_main").find(".send_sms").show()};var C=function(D){$.ajax({dataType:"json",type:"POST",data:{phone:D},url:requestContextPath+"/importAddress.action",beforeSend:function(E){},success:function(F,E){if(F){$.each(F,function(){$("#address_1").find("table").append(A.format([this.cityName,this.kfcIAddress.citycode,this.fullAddress,this.kfcIAddress.supplementaladdress,this.kfcIAddress.storecode,$("input[name=selAddressId]").size(),this.kfcIAddress.oaddressid,this.needMailFlag]))});$("#addAddress").hide();$("#address_1").show();$("#addAddressBtn").show();$("#import_addr_tip").hide();$("#addressAdd").hide()}else{base.yumTrackAlert(property.importAddressFail)}},complete:function(F,E){},error:function(){base.yumTrackAlert(property.BadRequest)}})}};var KFC_Password=function(G){var S=this;var B=$("#edit_pwd");var N=B.prev();var D=B.next();var R=$("#modifyPwdBtn");var C=$("#unlockPwdBtn");var L=$("#setPassword");var I=$("#savePwd");var M=I.next();var F=$("input[name=password]");var O=$("input[name=password1]");var P=$("input[name=password2]");var H=$("input[name=code]");var T=H.next("img");var E=/^[a-zA-Z0-9]{6,16}$/;this.empty=function(){O.val("");P.val("");H.val("")};var A=function(U){U.blur(function(){if(this.value==""){$(this).addClass("dn").prev().removeClass("dn")}}).prev().focus(function(){$(this).addClass("dn").next().removeClass("dn").focus();$(this).addClass("dn").prev().removeClass("dn")})};A(O);A(P);O.prev().val(property.inputPassword);P.prev().val(property.inputPasswordAgain);H.tip(property.inputCode);var Q=function(){var U=requestContextPath;if(U.indexOf("/en")>0){U=U.replace(/\/en/,"/")}setTimeout(function(){T.attr("src",U+"/code.jsp?random="+new Date().getTime())},5)};H.siblings("a,img").click(Q);M.click(function(){if(window._tag){_tag.dcsMultiTrack("wt.event","orderAlert","wt.msg","setpwdcans")}if(S.flag=="SET"){N.show();B.hide();O.val("")}else{if(S.flag=="MODIFY"){D.show();B.hide()}}});R.click(function(){S.flag="MODIFY";J();D.hide();B.show();Q()});C.click(function(){var b=function(){var d=$(this);setTimeout(function(){d.attr("src",requestContextPath+"/code.jsp?random="+new Date().getTime())},5)},Y=$('<p class="mt6px"/>'),V=$('<p style="margin: 5px 0 0;"/>'),Z=$('<span id="savePwd" class="new_add_img"><a href="javascript:void(0);">'+property.confirm+"</a></span>"),a=$('<a href="javascript:;" style="line-height:20px;">'+property.cancelLift+"</a>"),c=$('<input type="text" class="input_1"/>'),X=$('<img style="vertical-align:middle;margin-right:10px;"/>').click(b),U=$('<a href="javascript:;">'+property.plsRefresh+"</a>").click(function(){X.click()});Y.append(c,X,U);V.append(Z,a);c.tip(property.inputCode);var W=$("<div/>").append(Y,V);a.click(function(){W.remove();D.show()});Z.click(function(){if(c.val()!=""&&c.val()!=property.inputCode){if(common.isStr2(c.val(),1)){base.yumTrackAlert(property.invaildStringError);return}if(G.isNewUser){if(K(c.val())){W.remove()}N.show();F.val("");J();return}KFC_POST("/unlockPassword.action",{auth:c.val()},function(d){if(d.code==serviceCode.SUC_CODE){base.yumTrackAlertBack(property.unlockPasswordSuccessfully,function(){W.remove();N.show();window.location.href=requestContextPath+"/customer.action"})}else{if(d.code==serviceCode.AUTH_CODE_UNCORRECT){base.yumTrackAlertBack(property.EorInputCode,function(){c.val("").focus();X.click()})}else{base.yumTrackAlert(property.serviceUnknown)}}})}else{base.yumTrackAlert(property.inputCode)}});D.after(W);D.hide();setTimeout(function(){X.attr("src",requestContextPath+"/code.jsp?random="+new Date().getTime())},5)});L.click(function(){if(window._tag){_tag.dcsMultiTrack("wt.event","orderAlert","wt.msg","setpwd0")}if(G.isNewUser){J();S.flag="SET";N.hide();B.show();Q()}else{KFC_POST("/setPassword.action",{},function(U){if(U.code==serviceCode.SUC_CODE){base.yumTrackAlert(property.resetMail.format([G.userEmail]))}else{if(U.code==serviceCode.MAIL_SEND_FAIL){base.yumTrackAlert(property.emailSendFail)}else{if(U.code==serviceCode.USER_NOT_LOGIN){location.href=requestContextPathHttps+"/orderLogin.action"}else{base.yumTrackAlert(property.serviceUnknown)}}}})}});I.click(function(){var W=O.val();var V=P.val();var U=$.trim(H.val());if(W==""||!/^[a-zA-Z0-9]{6,16}$/.test(W)){base.yumTrackAlert(property.EorPasswordFormat);return}if(W!==V){base.yumTrackAlert(property.twoPasswordsDoNotMatch);return}if(!E.test(W)){base.yumTrackAlert(property.EorPasswordFormat);return}if(common.isStr2(W,1)){base.yumTrackAlert(property.invaildStringError);return}if(U==""||U==property.inputCode){base.yumTrackAlert(property.inputCode);Q();return}if(common.isStr2(U,1)){base.yumTrackAlert(property.invaildStringError);return}if(!G.isNewUser){KFC_POST("/modifyPassword.action",{password:W,auth:U},function(X){if(X.code==serviceCode.SUC_CODE){base.yumTrackAlertBack(property.setPasswordSuccessfully,function(){if(window._tag){_tag.dcsMultiTrack("wt.event","orderAlert","wt.msg","setpwdconf")}if(S.flag=="SET"){N.show();B.hide();O.val("")}else{if(S.flag=="MODIFY"){D.show();B.hide()}}})}else{if(X.code==serviceCode.AUTH_CODE_UNCORRECT){base.yumTrackAlertBack(property.EorInputCode,function(){H.val("").focus();Q()})}else{if(X.code==serviceCode.USER_NOT_LOGIN){loginExit(function(){location.href=requestContextPathHttps+"/orderLogin.action"})}else{if(X.code==serviceCode.VERIFY_VERIFICATION_CODE_ERROR){base.yumTrackAlert(property.EorNmuCode)}else{base.yumTrackAlert(property.serviceUnknown)}}}}})}else{if(H.val()!=""){if(K(H.val())){B.hide();D.show();F.val(W);if(window._tag){_tag.dcsMultiTrack("wt.event","orderAlert","wt.msg","setpwdconf")}base.yumTrackAlert(property.setPasswordSuccessfully)}}else{base.yumTrackAlert(property.inputCode)}}});var J=function(){O.val("").blur();P.val("").blur();H.val("").blur()};var K=function(U){var V=false;$.ajax({url:requestContextPath+"/auth.action",type:"post",data:{auth:U},dataType:"json",async:false,success:function(W){if(W.code==serviceCode.AUTH_CODE_UNCORRECT){base.yumTrackAlertBack(property.EorInputCode,function(){H.val("").focus();Q()})}else{if(W.code==serviceCode.SUC_CODE){V=true}else{base.yumTrackAlert(property.serviceUnknown)}}}});return V};this.noPassworddFlag=false;this.isFinish=function(V){if(!G.isNewUser){return true}if(F.val()){return true}var U=$("[name=selAddressId]:checked");if(!this.noPassworddFlag&&!O.val()&&U[0]){U=U.parent().prev("td").text();$("<div><span>"+property.noCodeWarn+U.replace(/^(.).+(.{2})$/,"$1*……*$2")+pageMessage.period+"</span></div>").dialog({resizable:false,minHeight:"96px",modal:true,closeOnEscape:true,dialogClass:"ui-alert",title:pageMessage.customer_remind,position:{my:"center",at:"center",of:window,collision:"fit"},buttons:{customer_setCode:function(){if(window._tag){_tag.dcsMultiTrack("wt.event","orderAlert","wt.msg","setpwd1")}$(this).remove();L.click()},customer_continueOrder:function(){if(window._tag){_tag.dcsMultiTrack("wt.event","orderAlert","wt.msg","gotomenu")}$(this).remove();V.click()}}});this.noPassworddFlag=true;return false}return this.noPassworddFlag};Q()};var KFC_Customer=function(){var E=this;this.isNewUser=$("#userFlag").val()==0?true:false;this.userEmail=$("#userEmail").val();this.userName="";this.gender="";this.phoneList=[];this.addressList=[];this.password="";var D=new KFC_Base(this);var C=new KFC_Phone(this);var G=new KFC_Address(this);var F=new KFC_Password(this);if($("#phoneUserFlag").val()=="1"){var B=new KFC_Osaddress();var A=$("#mobiOrMail").val();B.bindImportAddress(A)}$("#nextStep").click(function(){if(typeof(_tag)!="undefined"){_tag.dcsMultiTrack("WT.event","QRDC_order_KFC","WT.msg","26")}if(!D.isFinish()){return}if(!C.isFinish()){return}if(!G.isFinish()){return}if(!F.isFinish($(this))){if(!F.noPassworddFlag){base.yumTrackAlert(property.notSavePassword)}return}$.cookie(yumCfg.myNotNeed,null);F.empty();var H="No";if(!F.noPassworddFlag){H="Yes"}else{H="No"}base.initUserCookie();customerCommonFn.saveAddressToCkooie();customerCommonFn.savePhoneToCookie();if(G.flagOpenOline()=="true"){if(E.isNewUser){if(window._tag){_tag.dcsMultiTrack("wt.event","reg-suc","wt.setPwd",H)}base.setAction("regCustomer.action")}else{base.setAction("shopping.action")}}else{base.yumTrackAlertBack(property.notOnlinePay,function(){if(E.isNewUser){if(window._tag){_tag.dcsMultiTrack("wt.event","reg-suc","wt.setPwd",H)}base.setAction("regCustomer.action")}else{base.setAction("shopping.action")}})}})};var customerCommonFn={htmlTemp:'<div class="pop_con"><div class="newps newps-js updataPs"><div class="newpsline" id="phoneNmu"><div class="textinput" style="text-align: left;color:#AAA"><span style="margin-left: 5px;">{0}</span></div></div><div class="newpsline"><div class="textinput"><input name="code" type="text" tip="inputImageCode"></div><div class="radio_edit"><span class="radio_edit_img" id="verificationCode"><img style="cursor: pointer;"src="'+requestContextPath+"/code.jsp?random="+new Date().getTime()+'"></span><span class="radio_edit_text" id="verificationCodeRefesh"><a flag="updataPs" href="javascript:void(0);">'+property.plsRefresh1+'</a></span></div></div><div class="newpsline"><div class="textinput"><input name="code" type="text" tip="inputCode"></div><div class="radio_edit"><span class="radio_edit_text"><a href="javascript:void(0);" id="getSmsCode">'+pageMessage.clickphonecode+'</a></span></div></div><div class="newpsline tipMessage" style="color: red;text-align: left;"></div></div></div>',refreshCode:function(B){var A=requestContextPath;if(A.indexOf("/en")>0){A=A.replace(/\/en/,"/")}setTimeout(function(){B.attr("src",A+"/code.jsp?random="+new Date().getTime())},5)},countDown:function(B,A){var C=$(B);if(A>=0){if(typeof buttonDefaultValue==="undefined"){buttonDefaultValue=C.text()}C.data("dis",true);C.text(property.stormingBack+"("+A+pageMessage.secs+")");A--;setTimeout(function(){customerCommonFn.countDown(B,A)},1000)}else{C.data("dis",false);C.text(property.stormingBack)}},getSmsCaptcha:function(B,C,A){C=C||{};KFC_POST(A,C,function(D){var F=$(B).parents(".newpsline").prev().find("input[name=code]");var E=$(B).parents(".newpsline").prev().find(".radio_edit_img img");F.val(property.inputImageCode);customerCommonFn.refreshCode(E);if(D.code==serviceCode.SUC_CODE){customerCommonFn.countDown(B,60)}else{if(D.code==serviceCode.CAPTCHA_OUTTIME1){base.yumTrackAlert(property.sendSMSMore)}else{if(D.code==serviceCode.CAPTCHA_OUTTIME2){base.yumTrackAlert(property.sendSMSMore2)}else{if(D.code==serviceCode.AUTH_CODE_UNCORRECT){base.yumTrackAlert(property.EorImageInputCode)}else{base.yumTrackAlert(property.sendFailed)}}}}})},inputFocus:function(){$(".pop_con input").die("focus").live("focus",function(){var A=$(this);A.val("")})},inputBlur:function(){$(".pop_con input").die("blur").live("blur",function(){var B=$(this);var C=B.val();if(""==C||null==C){var A=B.attr("tip");B.val(property[A])}})},saveAddressToCkooie:function(){var D=$("input[name=selAddressId]").parent().parent().parent();var A=D.find(".selectcolor").index();var C=$("#cid").val();var B=$("input[name=selAddressId]").parents(".selectcolor").find("input[name=selAddressId]").val();if(A<0){$.cookie(yumCfg.rememberAddress+C,null,{path:"/"})}else{$.cookie(yumCfg.rememberAddress+C,B,{expires:yumCfg.keep,path:"/"})}},savePhoneToCookie:function(){var B=$("#phone_1 li.selectcolor").index();var A=$("#cid").val();if(B<0){$.cookie(yumCfg.rememberPhone+A,null,{path:"/"})}else{$.cookie(yumCfg.rememberPhone+A,B,{expires:yumCfg.keep,path:"/"})}}};$(function(){KFC_Customer();var A=$("#cid").val();var B=$.cookie(yumCfg.rememberPhone+A);if(B){$("#phone_1 li").eq(B).addClass("selectcolor").find("input[type=radio]").attr("checked","checked")}});